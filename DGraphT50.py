# Copyright 2019 D-Wave Systems, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Import networkx for graph tools
import networkx as nx

# Import dwave_networkx for d-wave graph tools/functions
import dwave_networkx as dnx

# Import matplotlib.pyplot to draw graphs on screen
# note: since there are people without an interactive matplotlib backend
# and since the code does not need said backend, we will explicitly call for
# a non-interactive backend, Agg. See the following for details:
# https://matplotlib.org/faq/usage_faq.html#what-is-a-backend
import matplotlib
matplotlib.use("agg")    # must select backend before importing pyplot
import matplotlib.pyplot as plt
# Import time to determinate the time the algorithm use to solve the problem
import time

# Set the solver we're going to use
from dimod.reference.samplers import ExactSolver


sampler = ExactSolver()

# Create empty graph
G = nx.Graph()

# Add edges to graph - this also adds the nodes
G.add_edges_from([(1, 3), (1, 16), (1, 17), (1, 23), (1, 24), (1, 27), (1, 30), (1, 31), (1, 33), (1, 34), (1, 39), (1, 42), (1, 46), (1, 48), (1, 49), (1, 50), (2, 4), (2, 13), (2, 17), (2, 18), (2, 19), (2, 22), (2, 27), (2, 28), (2, 30), (2, 32), (2, 34), (2, 38), (2, 45), (2, 46), (2, 48), (3, 6), (3, 8), (3, 9), (3, 10), (3, 14), (3, 17), (3, 18), (3, 21), (3, 22), (3, 28), (3, 29), (3, 37), (3, 42), (3, 46), (3, 48), (4, 1), (4, 7), (4, 8), (4, 15), (4, 17), (4, 18), (4, 21), (4, 26), (4, 28), (4, 33), (4, 35), (4, 36), (4, 42), (4, 49), (4, 50), (5, 1), (5, 8), (5, 9), (5, 11), (5, 13), (5, 14), (5, 18), (5, 20), (5, 26), (5, 33), (5, 36), (5, 39), (5, 43), (5, 44), (5, 46), (6, 1), (6, 2), (6, 4), (6, 7), (6, 14), (6, 19), (6, 21), (6, 22), (6, 23), (6, 31), (6, 39), (6, 40), (6, 42), (6, 45), (7, 15), (7, 19), (7, 20), (7, 24), (7, 25), (7, 26), (7, 33), (7, 37), (7, 40), (7, 43), (7, 44), (7, 45), (7, 46), (7, 48), (8, 1), (8, 2), (8, 9), (8, 11), (8, 14), (8, 17), (8, 23), (8, 24), (8, 28), (8, 32), (8, 33), (8, 38), (8, 44), (8, 46), (9, 6), (9, 7), (9, 10), (9, 14), (9, 18), (9, 20), (9, 22), (9, 24), (9, 27), (9, 29), (9, 34), (9, 38), (9, 40), (9, 42), (9, 43), (9, 46), (9, 47), (10, 5), (10, 7), (10, 11), (10, 12), (10, 13), (10, 14), (10, 18), (10, 20), (10, 22), (10, 25), (10, 28), (10, 33), (10, 36), (10, 39), (10, 40), (10, 41), (10, 48), (10, 49), (11, 1), (11, 3), (11, 7), (11, 9), (11, 13), (11, 14), (11, 15), (11, 19), (11, 23), (11, 27), (11, 33), (11, 35), (11, 40), (11, 43), (11, 45), (11, 46), (11, 50), (12, 1), (12, 2), (12, 5), (12, 13), (12, 15), (12, 20), (12, 21), (12, 22), (12, 26), (12, 29), (12, 31), (12, 32), (12, 33), (12, 35), (12, 41), (12, 44), (13, 3), (13, 4), (13, 7), (13, 14), (13, 16), (13, 17), (13, 21), (13, 22), (13, 24), (13, 25), (13, 30), (13, 33), (13, 35), (13, 37), (13, 40), (13, 41), (13, 45), (13, 46), (13, 47), (14, 1), (14, 2), (14, 19), (14, 24), (14, 26), (14, 27), (14, 28), (14, 30), (14, 31), (14, 34), (14, 35), (14, 36), (14, 40), (14, 49), (15, 1), (15, 2), (15, 5), (15, 10), (15, 14), (15, 19), (15, 20), (15, 26), (15, 30), (15, 31), (15, 33), (15, 34), (15, 36), (15, 39), (15, 42), (15, 44), (15, 45), (15, 50), (16, 2), (16, 3), (16, 6), (16, 15), (16, 19), (16, 20), (16, 26), (16, 28), (16, 31), (16, 34), (16, 36), (16, 38), (16, 42), (16, 43), (16, 44), (16, 48), (16, 49), (17, 5), (17, 7), (17, 11), (17, 18), (17, 22), (17, 23), (17, 27), (17, 29), (17, 30), (17, 31), (17, 33), (17, 35), (17, 36), (17, 38), (17, 42), (17, 45), (17, 48), (18, 1), (18, 6), (18, 11), (18, 13), (18, 15), (18, 22), (18, 25), (18, 26), (18, 28), (18, 31), (18, 32), (18, 33), (18, 40), (18, 41), (18, 46), (18, 47), (19, 5), (19, 8), (19, 9), (19, 10), (19, 13), (19, 17), (19, 23), (19, 25), (19, 28), (19, 31), (19, 32), (19, 49), (19, 50), (20, 1), (20, 3), (20, 4), (20, 14), (20, 17), (20, 18), (20, 25), (20, 27), (20, 37), (20, 38), (20, 45), (20, 46), (20, 49), (21, 2), (21, 5), (21, 8), (21, 9), (21, 10), (21, 14), (21, 17), (21, 19), (21, 26), (21, 27), (21, 36), (21, 39), (21, 43), (21, 45), (21, 46), (21, 48), (21, 50), (22, 14), (22, 15), (22, 16), (22, 23), (22, 25), (22, 26), (22, 35), (22, 40), (22, 43), (22, 44), (22, 46), (22, 48), (22, 50), (23, 12), (23, 21), (23, 24), (23, 26), (23, 30), (23, 33), (23, 38), (23, 39), (23, 46), (24, 3), (24, 6), (24, 10), (24, 17), (24, 19), (24, 21), (24, 22), (24, 26), (24, 29), (24, 30), (24, 32), (24, 33), (24, 36), (24, 37), (24, 41), (24, 42), (24, 45), (24, 47), (24, 48), (24, 50), (25, 1), (25, 2), (25, 3), (25, 4), (25, 8), (25, 9), (25, 12), (25, 14), (25, 23), (25, 29), (25, 30), (25, 32), (25, 34), (25, 35), (25, 37), (25, 40), (25, 42), (25, 43), (25, 45), (25, 46), (25, 49), (26, 1), (26, 2), (26, 9), (26, 10), (26, 17), (26, 19), (26, 20), (26, 28), (26, 30), (26, 34), (26, 35), (26, 38), (26, 39), (26, 41), (26, 42), (26, 45), (26, 47), (26, 49), (27, 3), (27, 7), (27, 15), (27, 22), (27, 23), (27, 26), (27, 33), (27, 48), (27, 50), (28, 5), (28, 7), (28, 9), (28, 13), (28, 21), (28, 27), (28, 29), (28, 31), (28, 33), (28, 36), (28, 38), (28, 39), (28, 40), (28, 45), (28, 46), (28, 50), (29, 6), (29, 8), (29, 11), (29, 13), (29, 30), (29, 33), (29, 35), (29, 36), (29, 37), (29, 40), (29, 46), (29, 47), (29, 50), (30, 4), (30, 7), (30, 10), (30, 18), (30, 27), (30, 28), (30, 32), (30, 33), (30, 35), (30, 39), (30, 41), (30, 47), (30, 50), (31, 3), (31, 4), (31, 5), (31, 10), (31, 13), (31, 23), (31, 24), (31, 27), (31, 30), (31, 34), (31, 37), (31, 38), (31, 42), (31, 47), (31, 49), (31, 50), (32, 1), (32, 4), (32, 14), (32, 16), (32, 22), (32, 27), (32, 31), (32, 33), (32, 41), (32, 42), (32, 44), (32, 48), (33, 2), (33, 6), (33, 9), (33, 21), (33, 22), (33, 39), (33, 42), (33, 43), (33, 45), (34, 6), (34, 10), (34, 17), (34, 21), (34, 37), (34, 38), (34, 40), (34, 41), (34, 43), (34, 44), (35, 3), (35, 6), (35, 8), (35, 10), (35, 15), (35, 21), (35, 23), (35, 27), (35, 28), (35, 34), (35, 36), (35, 40), (35, 46), (35, 49), (36, 3), (36, 13), (36, 22), (36, 26), (36, 30), (36, 34), (36, 38), (36, 45), (36, 46), (36, 50), (37, 2), (37, 8), (37, 9), (37, 11), (37, 15), (37, 19), (37, 33), (37, 36), (37, 49), (38, 1), (38, 5), (38, 11), (38, 15), (38, 19), (38, 24), (38, 30), (38, 33), (38, 41), (38, 46), (39, 4), (39, 9), (39, 11), (39, 12), (39, 14), (39, 17), (39, 19), (39, 20), (39, 24), (39, 32), (39, 35), (39, 36), (39, 38), (39, 43), (39, 50), (40, 12), (40, 16), (40, 17), (40, 24), (40, 33), (40, 41), (40, 42), (41, 2), (41, 8), (41, 14), (41, 16), (41, 19), (41, 20), (41, 23), (41, 25), (41, 27), (41, 28), (41, 31), (41, 35), (41, 37), (41, 44), (41, 49), (42, 2), (42, 5), (42, 7), (42, 14), (42, 20), (42, 29), (42, 35), (42, 38), (42, 41), (43, 1), (43, 2), (43, 10), (43, 14), (43, 19), (43, 32), (43, 35), (43, 37), (43, 38), (43, 42), (43, 45), (44, 1), (44, 2), (44, 4), (44, 9), (44, 10), (44, 13), (44, 19), (44, 20), (44, 21), (44, 39), (44, 42), (44, 45), (45, 8), (45, 9), (45, 14), (45, 19), (45, 23), (45, 29), (45, 37), (45, 38), (45, 39), (45, 40), (45, 41), (45, 47), (45, 50), (46, 4), (46, 6), (46, 15), (46, 16), (46, 17), (46, 24), (46, 30), (46, 34), (46, 37), (46, 39), (46, 48), (46, 49), (47, 3), (47, 4), (47, 6), (47, 7), (47, 12), (47, 23), (47, 25), (47, 27), (47, 32), (47, 36), (47, 41), (47, 46), (48, 8), (48, 11), (48, 15), (48, 23), (48, 28), (48, 29), (48, 33), (48, 34), (48, 35), (48, 38), (48, 39), (48, 40), (48, 41), (48, 45), (49, 15), (49, 17), (49, 18), (49, 29), (49, 32), (49, 38), (49, 42), (49, 43), (49, 44), (50, 2), (50, 3), (50, 5), (50, 6), (50, 7), (50, 8), (50, 12), (50, 16), (50, 18), (50, 23), (50, 25), (50, 26), (50, 32), (50, 35), (50, 37), (50, 40), (50, 46), (50, 48)])

start_time = time.time()

# Find the minimum vertex cover, S
S = dnx.min_vertex_cover(G, sampler=sampler, lagrange=5)
print("--- %s seconds ---" % (time.time() - start_time))

# Print the solution for the user
print('Minimum vertex cover found is', len(S))
print(S)

# Visualize the results
k = G.subgraph(S)
notS = list(set(G.nodes()) - set(S))
othersubgraph = G.subgraph(notS)
pos = nx.spring_layout(G)
plt.figure()

# Save original problem graph
original_name = "pipelines_plot_original_50.png"
nx.draw_networkx(G, pos=pos, with_labels=True)
plt.savefig(original_name, bbox_inches='tight')

# Save solution graph
# Note: red nodes are in the set, blue nodes are not
solution_name = "pipelines_plot_solution_50.png"
nx.draw_networkx(k, pos=pos, with_labels=True, node_color='r', font_color='k')
nx.draw_networkx(othersubgraph, pos=pos, with_labels=True, node_color='b', font_color='w')
plt.savefig(solution_name, bbox_inches='tight')

print("Your plots are saved to {} and {}".format(original_name, solution_name))

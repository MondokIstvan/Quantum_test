# Copyright 2019 D-Wave Systems, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Import networkx for graph tools
import networkx as nx

# Import dwave_networkx for d-wave graph tools/functions
import dwave_networkx as dnx

# Import matplotlib.pyplot to draw graphs on screen
# note: since there are people without an interactive matplotlib backend
# and since the code does not need said backend, we will explicitly call for
# a non-interactive backend, Agg. See the following for details:
# https://matplotlib.org/faq/usage_faq.html#what-is-a-backend
import matplotlib
matplotlib.use("agg")    # must select backend before importing pyplot
import matplotlib.pyplot as plt
# Import time to determinate the time the algorithm use to solve the problem
import time

# Set the solver we're going to use
from dimod.reference.samplers import ExactSolver


sampler = ExactSolver()

# Create empty graph
G = nx.Graph()

# Add edges to graph - this also adds the nodes
G.add_edges_from([(1, 2), (1, 3), (1, 7), (1, 11), (1, 12), (1, 17), (1, 18), (1, 27), (1, 33), (1, 35), (1, 37), (1, 39), (1, 40), (1, 42), (1, 44), (1, 45), (1, 47), (1, 49), (1, 50), (1, 51), (1, 55), (1, 56), (1, 57), (1, 59), (1, 60), (2, 4), (2, 6), (2, 9), (2, 11), (2, 16), (2, 20), (2, 21), (2, 25), (2, 30), (2, 34), (2, 40), (2, 43), (2, 51), (2, 53), (2, 55), (2, 58), (2, 59), (3, 2), (3, 4), (3, 7), (3, 9), (3, 10), (3, 12), (3, 13), (3, 18), (3, 23), (3, 35), (3, 37), (3, 40), (3, 44), (3, 47), (3, 52), (3, 53), (3, 55), (3, 56), (3, 58), (3, 59), (4, 5), (4, 16), (4, 20), (4, 22), (4, 28), (4, 32), (4, 35), (4, 43), (4, 46), (4, 48), (4, 50), (4, 52), (4, 54), (4, 55), (5, 3), (5, 7), (5, 8), (5, 11), (5, 17), (5, 22), (5, 23), (5, 27), (5, 32), (5, 35), (5, 39), (5, 41), (5, 44), (5, 47), (5, 48), (5, 50), (5, 53), (5, 56), (5, 57), (6, 4), (6, 12), (6, 18), (6, 23), (6, 24), (6, 27), (6, 28), (6, 30), (6, 35), (6, 37), (6, 39), (6, 41), (6, 47), (6, 48), (6, 49), (6, 52), (6, 53), (6, 55), (6, 60), (7, 4), (7, 10), (7, 12), (7, 15), (7, 16), (7, 17), (7, 18), (7, 20), (7, 22), (7, 28), (7, 31), (7, 35), (7, 39), (7, 43), (7, 44), (7, 49), (7, 51), (7, 54), (7, 58), (7, 60), (8, 2), (8, 3), (8, 4), (8, 6), (8, 7), (8, 13), (8, 19), (8, 20), (8, 21), (8, 22), (8, 23), (8, 27), (8, 29), (8, 31), (8, 37), (8, 38), (8, 39), (8, 41), (8, 45), (8, 47), (8, 48), (8, 53), (8, 57), (9, 4), (9, 5), (9, 6), (9, 8), (9, 14), (9, 15), (9, 17), (9, 21), (9, 22), (9, 24), (9, 28), (9, 40), (9, 42), (9, 45), (9, 47), (9, 50), (9, 51), (9, 55), (9, 57), (10, 6), (10, 9), (10, 15), (10, 16), (10, 20), (10, 21), (10, 25), (10, 30), (10, 32), (10, 35), (10, 36), (10, 40), (10, 42), (10, 46), (10, 48), (10, 56), (11, 4), (11, 8), (11, 9), (11, 10), (11, 13), (11, 17), (11, 18), (11, 19), (11, 23), (11, 30), (11, 36), (11, 38), (11, 43), (11, 45), (11, 47), (11, 48), (12, 2), (12, 4), (12, 11), (12, 18), (12, 22), (12, 24), (12, 25), (12, 27), (12, 28), (12, 29), (12, 30), (12, 32), (12, 34), (12, 35), (12, 36), (12, 39), (12, 40), (12, 41), (12, 43), (12, 46), (12, 47), (12, 49), (12, 50), (12, 51), (12, 52), (12, 56), (12, 58), (13, 7), (13, 17), (13, 18), (13, 20), (13, 22), (13, 25), (13, 28), (13, 30), (13, 33), (13, 34), (13, 35), (13, 41), (13, 48), (13, 49), (13, 50), (13, 55), (14, 4), (14, 5), (14, 11), (14, 15), (14, 16), (14, 19), (14, 22), (14, 23), (14, 25), (14, 26), (14, 28), (14, 29), (14, 31), (14, 32), (14, 33), (14, 34), (14, 35), (14, 36), (14, 38), (14, 41), (14, 42), (14, 43), (14, 44), (14, 45), (14, 48), (14, 51), (14, 53), (14, 54), (14, 59), (15, 1), (15, 2), (15, 12), (15, 13), (15, 17), (15, 18), (15, 19), (15, 21), (15, 25), (15, 27), (15, 28), (15, 29), (15, 31), (15, 32), (15, 33), (15, 38), (15, 40), (15, 42), (15, 45), (15, 51), (15, 53), (15, 58), (15, 60), (16, 3), (16, 9), (16, 11), (16, 17), (16, 19), (16, 20), (16, 21), (16, 23), (16, 29), (16, 30), (16, 32), (16, 34), (16, 37), (16, 38), (16, 42), (16, 43), (16, 47), (16, 48), (16, 53), (16, 55), (16, 56), (16, 57), (16, 60), (17, 3), (17, 4), (17, 6), (17, 10), (17, 14), (17, 20), (17, 29), (17, 30), (17, 31), (17, 33), (17, 35), (17, 36), (17, 38), (17, 49), (17, 50), (17, 53), (17, 56), (17, 60), (18, 8), (18, 9), (18, 10), (18, 17), (18, 20), (18, 21), (18, 22), (18, 25), (18, 27), (18, 29), (18, 30), (18, 31), (18, 32), (18, 40), (18, 45), (18, 48), (18, 49), (18, 53), (18, 54), (18, 58), (18, 60), (19, 1), (19, 2), (19, 5), (19, 6), (19, 13), (19, 17), (19, 21), (19, 24), (19, 25), (19, 26), (19, 32), (19, 40), (19, 41), (19, 42), (19, 49), (19, 50), (19, 56), (20, 1), (20, 5), (20, 11), (20, 12), (20, 21), (20, 29), (20, 31), (20, 36), (20, 38), (20, 43), (20, 45), (20, 47), (20, 53), (20, 56), (21, 1), (21, 3), (21, 5), (21, 12), (21, 22), (21, 29), (21, 38), (21, 42), (21, 44), (21, 50), (21, 53), (21, 59), (22, 10), (22, 28), (22, 30), (22, 31), (22, 32), (22, 36), (22, 40), (22, 41), (22, 43), (22, 45), (22, 46), (22, 49), (22, 52), (22, 53), (22, 56), (23, 1), (23, 2), (23, 10), (23, 12), (23, 13), (23, 18), (23, 22), (23, 25), (23, 29), (23, 35), (23, 36), (23, 39), (23, 47), (23, 53), (23, 54), (23, 57), (23, 58), (23, 59), (23, 60), (24, 3), (24, 8), (24, 14), (24, 16), (24, 18), (24, 27), (24, 29), (24, 30), (24, 32), (24, 34), (24, 37), (24, 38), (24, 39), (24, 40), (24, 41), (24, 44), (24, 45), (24, 48), (24, 52), (24, 55), (24, 57), (24, 58), (24, 60), (25, 6), (25, 11), (25, 17), (25, 20), (25, 28), (25, 32), (25, 36), (25, 37), (25, 40), (25, 41), (25, 42), (25, 44), (25, 45), (25, 50), (25, 53), (25, 59), (26, 1), (26, 6), (26, 8), (26, 9), (26, 12), (26, 17), (26, 20), (26, 22), (26, 23), (26, 27), (26, 30), (26, 31), (26, 32), (26, 37), (26, 38), (26, 40), (26, 41), (26, 44), (26, 47), (26, 48), (26, 51), (26, 53), (26, 54), (26, 55), (26, 56), (26, 57), (26, 58), (26, 60), (27, 9), (27, 16), (27, 19), (27, 34), (27, 35), (27, 42), (27, 44), (27, 45), (27, 46), (27, 47), (27, 49), (27, 50), (27, 51), (27, 53), (27, 56), (28, 1), (28, 2), (28, 3), (28, 11), (28, 16), (28, 33), (28, 34), (28, 39), (28, 43), (28, 51), (28, 53), (28, 54), (28, 56), (28, 59), (28, 60), (29, 6), (29, 9), (29, 11), (29, 26), (29, 31), (29, 34), (29, 36), (29, 37), (29, 43), (29, 45), (29, 49), (29, 51), (29, 54), (29, 56), (30, 7), (30, 14), (30, 21), (30, 25), (30, 32), (30, 34), (30, 37), (30, 42), (30, 44), (30, 46), (30, 47), (30, 51), (30, 54), (30, 55), (30, 57), (31, 1), (31, 3), (31, 21), (31, 32), (31, 34), (31, 35), (31, 36), (31, 37), (31, 42), (31, 47), (31, 49), (31, 50), (31, 56), (32, 1), (32, 3), (32, 6), (32, 9), (32, 27), (32, 28), (32, 38), (32, 39), (32, 40), (32, 42), (32, 44), (32, 46), (32, 51), (32, 53), (32, 55), (32, 56), (33, 3), (33, 4), (33, 8), (33, 9), (33, 10), (33, 18), (33, 19), (33, 21), (33, 24), (33, 26), (33, 30), (33, 32), (33, 34), (33, 37), (33, 41), (33, 45), (33, 47), (33, 49), (33, 51), (33, 56), (33, 57), (33, 58), (33, 59), (34, 6), (34, 11), (34, 19), (34, 20), (34, 21), (34, 22), (34, 23), (34, 25), (34, 26), (34, 35), (34, 37), (34, 39), (34, 49), (34, 50), (34, 54), (34, 58), (35, 2), (35, 15), (35, 21), (35, 22), (35, 24), (35, 26), (35, 28), (35, 37), (35, 39), (35, 40), (35, 41), (35, 43), (35, 51), (35, 55), (35, 57), (36, 1), (36, 2), (36, 5), (36, 7), (36, 8), (36, 9), (36, 24), (36, 26), (36, 27), (36, 28), (36, 32), (36, 45), (36, 48), (36, 51), (36, 56), (36, 60), (37, 2), (37, 4), (37, 23), (37, 36), (37, 40), (37, 44), (37, 54), (37, 58), (38, 2), (38, 3), (38, 4), (38, 9), (38, 10), (38, 12), (38, 25), (38, 40), (38, 41), (38, 42), (38, 45), (38, 48), (38, 51), (38, 53), (38, 54), (38, 57), (38, 59), (39, 11), (39, 13), (39, 16), (39, 17), (39, 18), (39, 22), (39, 27), (39, 30), (39, 33), (39, 37), (39, 38), (39, 41), (39, 42), (39, 49), (39, 51), (39, 55), (39, 58), (39, 60), (40, 6), (40, 8), (40, 13), (40, 14), (40, 33), (40, 52), (40, 56), (40, 58), (41, 2), (41, 4), (41, 9), (41, 10), (41, 21), (41, 30), (41, 31), (41, 34), (41, 37), (41, 40), (41, 44), (41, 45), (41, 46), (41, 48), (41, 58), (42, 4), (42, 5), (42, 6), (42, 7), (42, 13), (42, 17), (42, 18), (42, 20), (42, 22), (42, 33), (42, 36), (42, 44), (42, 49), (42, 53), (42, 55), (42, 56), (42, 58), (43, 13), (43, 23), (43, 25), (43, 26), (43, 31), (43, 33), (43, 36), (43, 39), (43, 40), (43, 41), (43, 45), (43, 46), (43, 58), (44, 6), (44, 16), (44, 28), (44, 33), (44, 34), (44, 35), (44, 36), (44, 39), (44, 40), (44, 46), (44, 55), (44, 57), (44, 58), (44, 59), (45, 7), (45, 10), (45, 12), (45, 16), (45, 17), (45, 30), (45, 31), (45, 40), (45, 42), (45, 44), (45, 47), (45, 52), (45, 53), (45, 54), (45, 55), (45, 56), (46, 1), (46, 5), (46, 6), (46, 11), (46, 13), (46, 15), (46, 17), (46, 19), (46, 24), (46, 33), (46, 34), (46, 35), (46, 36), (46, 39), (46, 49), (46, 51), (46, 53), (46, 54), (46, 55), (46, 57), (46, 60), (47, 2), (47, 17), (47, 18), (47, 21), (47, 29), (47, 32), (47, 44), (47, 49), (47, 52), (47, 55), (47, 56), (47, 57), (48, 7), (48, 19), (48, 21), (48, 22), (48, 25), (48, 28), (48, 31), (48, 32), (48, 37), (48, 42), (48, 43), (48, 50), (48, 51), (49, 2), (49, 3), (49, 5), (49, 8), (49, 10), (49, 23), (49, 26), (49, 30), (49, 35), (49, 36), (49, 37), (49, 40), (49, 41), (49, 43), (49, 45), (49, 56), (49, 59), (50, 2), (50, 3), (50, 6), (50, 8), (50, 16), (50, 18), (50, 26), (50, 28), (50, 29), (50, 35), (50, 40), (50, 43), (50, 46), (50, 49), (50, 51), (50, 59), (51, 3), (51, 8), (51, 21), (51, 24), (51, 41), (51, 43), (51, 47), (51, 49), (51, 53), (51, 59), (51, 60), (52, 7), (52, 13), (52, 14), (52, 15), (52, 18), (52, 20), (52, 26), (52, 29), (52, 37), (52, 50), (52, 54), (52, 56), (52, 59), (53, 9), (53, 11), (53, 13), (53, 19), (53, 34), (53, 36), (53, 37), (53, 39), (53, 47), (53, 48), (53, 52), (53, 55), (53, 59), (54, 8), (54, 13), (54, 17), (54, 19), (54, 21), (54, 22), (54, 31), (54, 35), (54, 36), (54, 42), (54, 49), (54, 56), (54, 59), (55, 5), (55, 7), (55, 8), (55, 14), (55, 22), (55, 27), (55, 28), (55, 33), (55, 36), (55, 37), (55, 40), (55, 43), (55, 48), (55, 49), (55, 52), (55, 54), (55, 56), (55, 57), (55, 59), (55, 60), (56, 2), (56, 4), (56, 8), (56, 11), (56, 18), (56, 23), (56, 24), (56, 25), (56, 35), (56, 41), (56, 51), (56, 57), (56, 58), (56, 59), (57, 3), (57, 10), (57, 13), (57, 14), (57, 17), (57, 25), (57, 28), (57, 31), (57, 32), (57, 40), (57, 45), (57, 58), (58, 5), (58, 6), (58, 10), (58, 11), (58, 20), (58, 21), (58, 22), (58, 28), (58, 31), (58, 36), (58, 48), (58, 50), (58, 53), (58, 60), (59, 5), (59, 7), (59, 8), (59, 12), (59, 27), (59, 31), (59, 34), (59, 39), (59, 43), (59, 45), (59, 47), (59, 57), (59, 58), (60, 2), (60, 3), (60, 5), (60, 8), (60, 9), (60, 10), (60, 13), (60, 19), (60, 21), (60, 31), (60, 33), (60, 35), (60, 40), (60, 41), (60, 43), (60, 45), (60, 47), (60, 50)])

start_time = time.time()

# Find the minimum vertex cover, S
S = dnx.min_vertex_cover(G, sampler=sampler, lagrange=5)
print("--- %s seconds ---" % (time.time() - start_time))

# Print the solution for the user
print('Minimum vertex cover found is', len(S))
print(S)

# Visualize the results
k = G.subgraph(S)
notS = list(set(G.nodes()) - set(S))
othersubgraph = G.subgraph(notS)
pos = nx.spring_layout(G)
plt.figure()

# Save original problem graph
original_name = "pipelines_plot_original_60.png"
nx.draw_networkx(G, pos=pos, with_labels=True)
plt.savefig(original_name, bbox_inches='tight')

# Save solution graph
# Note: red nodes are in the set, blue nodes are not
solution_name = "pipelines_plot_solution_60.png"
nx.draw_networkx(k, pos=pos, with_labels=True, node_color='r', font_color='k')
nx.draw_networkx(othersubgraph, pos=pos, with_labels=True, node_color='b', font_color='w')
plt.savefig(solution_name, bbox_inches='tight')

print("Your plots are saved to {} and {}".format(original_name, solution_name))
